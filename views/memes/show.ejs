<%- include('../partials/header') %>  <!-- Include site-wide header (nav, title, etc) -->
<%- include('../partials/flash') %>   <!-- Show flash success/error messages -->

<h1><%= meme.name %></h1>

<% // ðŸ’¾ If a user is logged in, show the Favorite/Unfavorite button %>
<% if (currentUser) { %>
  <form 
    method="POST" 
    action="/favorites/<%= meme._id %>/favorite?_method=<%= isFavorited ? 'DELETE' : 'POST' %>" 
    class="d-inline"
  >
    <button 
      type="submit" 
      class="btn btn-sm <%= isFavorited ? 'btn-danger' : 'btn-outline-danger' %>"
    >
      <%= isFavorited ? 'â¤ï¸ Unfavorite' : 'ðŸ¤ Favorite' %>  <% // Show correct label based on user's status %>
    </button>
  </form>
<% } %>

<% // ðŸ’¬ Show the total number of users who have favorited this meme %>
<span><%= favoriteCount %> Favorites</span>

<span><%= favoriteCount %> Favorites</span>
<p style="white-space: pre-line;"><%= meme.description %></p>

<% if (meme.images && meme.images.length > 0) { %>
  <% meme.images.forEach(function(imgUrl) { %>
    <a href="/memes/<%= meme._id %>">
      <img
        src="<%= imgUrl %>"
        alt="<%= meme.name %>"
        class="me-2 mb-2 img-fluid rounded"
        style="max-height: 150px;"
      />
    </a>
  <% }) %>
<% } else if (meme.image) { %>
  <a href="/memes/<%= meme._id %>">
    <img
      src="<%= meme.image %>"
      alt="<%= meme.name %>"
      class="mb-2 img-fluid rounded"
      style="max-height: 150px;"
    />
  </a>
<% } %>

<% if (meme.tags && meme.tags.length > 0) { %>
  <div class="mb-3">
    <h5>Tags:</h5>
    <% meme.tags.forEach(tag => { %>
      <a href="/tags/<%= tag.name %>" class="badge text-bg-secondary text-decoration-none"><%= tag.name %></a>
    <% }) %>
  </div>
<% } %>


<% if (meme.createdAt && meme.updatedAt && meme.createdBy) { %>
  <p class="text-muted small mt-3">
    Added by <strong><%= meme.createdBy?.name %></strong>
    on <%= meme.createdAt.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %><br>
    Last updated <%= meme.updatedAt.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
  </p>
<% } %>
<div class="d-flex gap-2 mt-3">
  <!-- Edit button: only show if a user is logged in AND they created this meme -->
  <% if (currentUser && meme.createdBy && meme.createdBy.equals(currentUser._id)) { %>
    <a href="/memes/<%= meme._id %>/edit" class="btn btn-secondary">Edit Meme</a>
  <% } %>

  <!-- Back to All Memes: always visible to everyone -->
  <a href="/memes" class="btn btn-secondary">Back to All Memes</a>

  <!-- Delete button: only show if a user is logged in AND they created this meme -->
  <% if (currentUser && meme.createdBy && meme.createdBy.equals(currentUser._id)) { %>
    <form action="/memes/<%= meme._id %>?_method=DELETE" method="POST" style="display:inline;">
      <button type="submit" class="btn btn-danger">Delete Meme</button>
    </form>
  <% } %>
</div>

<%- include('../partials/test-footer') %>  <!-- site-wide footer (scripts, links, etc) -->